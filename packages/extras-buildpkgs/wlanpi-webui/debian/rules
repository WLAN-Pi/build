#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

ROOT_PATH=debian/wlanpi-webui
SPEEDTEST_PATH=$(ROOT_PATH)/var/www/speedtest
NGINX_PATH=$(ROOT_PATH)/etc/nginx
NGINX_SITES_PATH=$(NGINX_PATH)/sites-enabled
SYSTEMD_PATH=$(ROOT_PATH)/lib/systemd/system
PHP_FPM_PATH=$(ROOT_PATH)/etc/php/7.3/fpm

%:
	dh $@ --with systemd

override_dh_auto_install:
	mkdir -p $(SPEEDTEST_PATH) \
			 $(NGINX_PATH) \
			 $(NGINX_SITES_PATH) \
			 $(SYSTEMD_PATH) \
			 $(PHP_FPM_PATH)
	install -p -m 644 deployment/php/php.ini $(PHP_FPM_PATH)
	cp -ra speedtest/src/* $(SPEEDTEST_PATH)
	chown -R www-data:www-data $(SPEEDTEST_PATH)
	install -p -m 644 deployment/nginx/nginx.conf $(NGINX_PATH)
	cp -a deployment/nginx/wlanpi* $(NGINX_SITES_PATH)
	install -o root -g root -m 644 deployment/systemd/wlanpi_webui.s* /lib/systemd/system
	# Do normal install
	dh_auto_install
